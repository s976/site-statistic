#Так вот, что нам нужно?  
Человер заходит на сайт. Получает страницу. На ней скрипт.
Скрипт обращается к серверу: передает иформацию  о себе, и получает в ответ информацию о странице (сколько было на ней посещений и т.д.).  
 
##Какую информацию передает страница и каким образом?
Часть инфы передается автоматически в запросе http, а часть нужно передать в теле запроса.  
**Автоматом**
* IP  
* Referer - какая это страница  

**В теле**
* *id страницы - под вопросом - нужно ли*
* [ ] Заголовок страницы (нужно чтобы возвращать потом какие страницы смотрят сейчас). Если это пост - просто заголовок, если категория "Категория: такая-то" 

Запрос POST (так проще для кросдоменности - а с PUT сложности)

##Какую инфу дает в ответ сервер?
* [ x ]Количество посещений (*) 
* [ ] Сколько посетителей сейчас
* [ ] Какие страницы смотрели в последнее время
 

##Как обрабатывается запрос?
Проверяем был ли в последние 5 минут запрос с этого ИП с этой страницы.  
Если **да** - записывать ничего не надо. Ответ стандартный.  
Если **нет** - надо записать в БД. Ответ стандартный.

####Что записываем в БД?
1. Запись в журнал
1. Запись об этой странице  

##Структура БД (колекции)
**Колекция 1 - Общий журнал**  
Записывается каждый запрос.  
*Что записываем*  
1. Дата
1. IP
1. URL
 
**Колекция 2 - инфа о страницах**
В принципе, все уже есть в журнале. Но для экономии рессурсов - нужна эта колекция.  
*Что записываем*  
1. URL страницы (а может лучше ее ID?)
1. Количество посещений
1. Дата последнего посещения (а может не надо этого)
1. Заголовок страницы. Если это пост - просто заголовок, если категория "Категория: такая-то" 

##Модули БД
####records.js 
*Журанал. Регистрирует каждый отдельный заход. См. колекция 1*  
**Методы (статичные):**  
1. Запись инфы о визите
1. Проверка нужно ли записывать данный визит
1. Сколько посетителей есть сейчас (в последние Х минут) 


####pages.js 
*Обновляет статистику страницы. См. колекция 2*  
**Методы (статичные):**
1. Обновление статистики.
   - Проверяем существует ли запись этой страницы
     - если да:
       - увеличивает кол. посещений на 1
     - если нет:
       - создает запись и ставит кол. посещений = 1
1. Запрос статистики для данной страницы


##Модуль обработки запроса
*По крайней мере на данном этапе - это в раутере*

1. [ x ] Проверяем с какого домена запрос
   - если не подходит - отвечаем 400 и выходим из раутера 
1. Запрос статистики для страницы.
   - если стр. уже существует:
     - готовим ответ с данными о статистике стр.
   - если стр. еще не существует:
     - готовим ответ как бы созданного объекта с кол. визитов = 1
1. Запрос кол. посетителей сейчас. Как параметр передается уже частично подготовленный ответ. 
    - Ответ сервера с дополненной переменной ответа
1. [ x ] Обращаемся к методу модуля records.js, который проверяет нужно ли регистрировать.
    - Если да:      
      - обновление статистики стр.
      - добавление в журнал
      

#Оптимизация
Нужно к базе меньше обращаться!
